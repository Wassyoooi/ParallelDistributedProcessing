\documentclass[14pt, oneside]{article}     	% use "amsart" instead of "article" for AMSLaTeX format
\usepackage{geometry}                		% See geometry.pdf to learn the layout options. There are lots.
\usepackage[dvipdfmx]{hyperref}

\geometry{left=25mm,right=25mm,top=30mm,bottom=30mm}
\geometry{letterpaper}                   		% ... or a4paper or a5paper or ...
%\geometry{landscape}                		% Activate for rotated page geometry
%\usepackage[parfill]{parskip}    		% Activate to begin paragraphs with an empty line rather than an indent
\usepackage[dvipdfmx]{graphicx}				% Use pdf, png, jpg, or eps§ with pdflatex; use eps in DVI mode
								% TeX will automatically convert eps --> pdf in pdflatex
\usepackage{amssymb}
\usepackage{here}

\usepackage{listings}
\renewcommand{\lstlistingname}{コード}
%SetFonts
\lstset{%
  language={Python},
  basicstyle={\small},%
  identifierstyle={\small},%
  commentstyle={\small\itshape},%
  keywordstyle={\small\bfseries},%
  ndkeywordstyle={\small},%
  stringstyle={\small\ttfamily},
  frame={single},
  breaklines=true,
  columns=[l]{fullflexible},%
  numbers=left,%
  xrightmargin=0zw,%
  xleftmargin=3zw,%
  numberstyle={\scriptsize},%
  stepnumber=1,
  numbersep=1zw,%
  lineskip=-0.5ex%
}
%SetFonts

\title{並列分散処理  最終レポート}
\author{チームE　大城 慶知　眞榮城 隆守　伊波卓浩　宮良友也}
%\date{}							% Activate to display a given date or no date

\begin{document}
\maketitle

\section*{最終報告書に載せるやつ(あとで消すやつ)}

演習の背景、目的、方法、結果、考察をA410ページ以内で適切にまとめる。
個々のメンバーの役割分担を明記する。記載がない場合、あるいは、曖昧な場合には、
減点の対象となる。例えば、あるタスクを複数名で担当した場合でも、個々のメンバーの
役割をできる限り区別して説明する。
最終報告書にはソースコードのgithubリポジトリも記載する。

\section{演習の背景}
「講義で説明した並列分散処理を実践し、他者に有益な情報となるように共有せよ。」という課題が渡された。

b3前期はメンバーが忙しく時間も取れないので軽量かつ有益な情報をということで、
GPUマシンを使った並列処理を断腸の思いで断念し、Pythonにおける非同期処理を用いたI/Oの並列処理を行うことにした。

\section{目的}
Pythonのスレッドとconcurrentを用いて並列化を行うとともに、
async awaitの使うことで非同期処理を行いさらに速度向上を目指す。

\section{Pythonの事前知識}

\subsection{スレッドの制約}
Pythonでは、GIL(Global Interpreter Lock)と呼ばれる制約がある。
GILとは、Figure \ref{multithred_iobound}と Figure\ref{multithred_cpubound}のようにPythonを実行した際に一つだけしかスレッドのリソースを起動できない制約である。
そのため、PythonのCPUバウンドの並列処理はプロセスを使って、I/Oバウンドの並列処理はスレッドを行う事が多い。


\begin{figure}[H]
  \centering
  \includegraphics[width=10cm]{multithred_iobound.png}
  \caption{マルチスレッドI/Oバウンド}
  \label{multithred_iobound}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=10cm]{multithred_cpubound.png}
  \caption{マルチスレッドCPUバウンド}
  \label{multithred_cpubound}
\end{figure}




\subsection{asyncとawait}

\begin{lstlisting}[caption=FizzBuzz using async-await]
import asyncio

def fizzbuzz(i):
    if i == 15:
        return 'FizzBuzz'
    if i % 5 == 0:
        return 'Buzz'
    if i % 3 == 0:
        return 'Fizz'
    return str(i)

async def task_fizzbuzz(prefix):
    for x in range(1, 31):
        await asyncio.sleep(0.3)
        print(prefix + "{}:".format(str(x)) + fizzbuzz(x))
    return None

loop = asyncio.get_event_loop()
# コルーチン1000個生成
tasks = asyncio.wait([task_fizzbuzz(str(i) + ":") for i in range(1, 1000)])
loop.run_until_complete(tasks)
loop.close()

\end{lstlisting}

\subsection{プロセスを用いた}


\section{実験方法}

HTTPのGETを用いて実験を行った。
GETを複数回実行する場合を考えると、
逐次処理の場合ではレスポンスがあるまで
次のGETを送信することができない。
これを並列処理により
レスポンスを待つことなく
次のGETを実行した。
これにより効率よく
GETを実行し、
結果を受け取ることができると
想定した。

\begin{lstlisting}[caption=シンプレクス法プログラム]
# Example 2: asynchronous requests
import asyncio
import requests
import time

start = 0

async def main():
    start = time.time()

    for num in range(4):
        loop = asyncio.get_event_loop()
        futures = [
            loop.run_in_executor(
                None,
                requests.get,
                'https://ie.u-ryukyu.ac.jp/'
            )
            for i in range(5)
        ]
        for response in await asyncio.gather(*futures):
            print(time.time() - start)
            pass

loop = asyncio.get_event_loop()
loop.run_until_complete(main())

\end{lstlisting}

\section{実行結果}

ああ

\begin{figure}[h]
  \centering
  \includegraphics[width=10cm]{time.png}
  \caption{実行結果}
\end{figure}

こうなりました。

しゅごいぃぃぃぃぃぃぃぃぃぃぃぃぃっっ


\section{考察}






\section{感想・意見}
\section*{GitHubのURL}

\subsection*{https://github.com/e165719/ParallelDistributedProcessing}

\end{document}
